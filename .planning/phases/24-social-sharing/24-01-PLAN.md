---
phase: 24-social-sharing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Models/ShareableProgressImage.swift
  - W8Trackr/Models/ShareType.swift
  - W8Trackr/Views/Sharing/ShareableProgressView.swift
  - W8Trackr/Views/Sharing/ProgressImageGenerator.swift
autonomous: true

must_haves:
  truths:
    - "ShareableProgressImage conforms to Transferable and exports PNG data"
    - "ShareableProgressView renders at fixed 600x315 size with app branding"
    - "ProgressImageGenerator produces non-nil UIImage at device scale"
    - "Privacy mode hides exact weight when weightChange is nil"
  artifacts:
    - path: "W8Trackr/Models/ShareableProgressImage.swift"
      provides: "Transferable wrapper for UIImage sharing"
      contains: "Transferable"
    - path: "W8Trackr/Models/ShareType.swift"
      provides: "ShareType enum with celebration emojis"
      contains: "enum ShareType"
    - path: "W8Trackr/Views/Sharing/ShareableProgressView.swift"
      provides: "Fixed-size SwiftUI view for image rendering"
      contains: "frame(width: 600, height: 315)"
    - path: "W8Trackr/Views/Sharing/ProgressImageGenerator.swift"
      provides: "ImageRenderer wrapper with @MainActor"
      contains: "ImageRenderer"
  key_links:
    - from: "W8Trackr/Views/Sharing/ProgressImageGenerator.swift"
      to: "W8Trackr/Views/Sharing/ShareableProgressView.swift"
      via: "ImageRenderer(content: ShareableProgressView(...))"
      pattern: "ImageRenderer.*ShareableProgressView"
    - from: "W8Trackr/Models/ShareableProgressImage.swift"
      to: "UniformTypeIdentifiers"
      via: "exportedContentType: .png"
      pattern: "exportedContentType.*png"
---

<objective>
Create the core infrastructure for social sharing: Transferable image wrapper, share content types, the fixed-size SwiftUI view for rendering, and the ImageRenderer-based generator.

Purpose: Establish the data layer and rendering pipeline that Plan 02 will wire into the UI. These are the building blocks that enable image generation and sharing.

Output:
- ShareableProgressImage.swift (Transferable conformance for ShareLink)
- ShareType.swift (enum with celebration emojis and titles)
- ShareableProgressView.swift (the 600x315 view that gets rendered to image)
- ProgressImageGenerator.swift (@MainActor wrapper around ImageRenderer)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-social-sharing/24-RESEARCH.md

# Existing patterns to follow
@W8Trackr/Views/ExportView.swift (ShareLink + Transferable pattern)
@W8Trackr/Theme/Gradients.swift (AppGradients.celebration for shareable view background)
@W8Trackr/Theme/Colors.swift (AppColors.Fallback for shareable views - avoid asset catalog colors in ImageRenderer)
@specs/003-social-sharing/data-model.md (ShareType enum, SharingPreferences)
@specs/003-social-sharing/contracts/ProgressImageRenderer.swift (Contract - implement fully)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create share content types</name>
  <files>
    W8Trackr/Models/ShareableProgressImage.swift
    W8Trackr/Models/ShareType.swift
  </files>
  <action>
Create two new files in W8Trackr/Models/:

**ShareType.swift:**
```swift
enum ShareType: String, CaseIterable {
    case milestoneAchievement   // 25%, 50%, 75%, 100% progress
    case progressSummary        // Overall progress to date
    case goalAchieved           // Final goal completion

    var celebrationEmoji: String {
        switch self {
        case .milestoneAchievement: return "üéâ"
        case .progressSummary: return "üìà"
        case .goalAchieved: return "üèÜ"
        }
    }

    var defaultTitle: String {
        switch self {
        case .milestoneAchievement: return "Progress Milestone"
        case .progressSummary: return "My Progress"
        case .goalAchieved: return "Goal Achieved!"
        }
    }
}
```

**ShareableProgressImage.swift:**
- Import SwiftUI and UniformTypeIdentifiers
- Create struct with `let image: UIImage` and `let title: String`
- Conform to Transferable with DataRepresentation(exportedContentType: .png)
- Use `image.pngData()` for export, throw CocoaError(.fileWriteUnknown) if nil
- Follow exact pattern from ExportView.swift's ExportFile but for PNG image data

Do NOT use @Observable or ObservableObject - these are simple value types.
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build 2>&1 | grep -E "(error:|BUILD SUCCEEDED)"`
  </verify>
  <done>
ShareType enum exists with 3 cases and computed properties. ShareableProgressImage conforms to Transferable and exports PNG data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shareable view and image generator</name>
  <files>
    W8Trackr/Views/Sharing/ShareableProgressView.swift
    W8Trackr/Views/Sharing/ProgressImageGenerator.swift
  </files>
  <action>
Create W8Trackr/Views/Sharing/ directory and add two files:

**ShareableProgressView.swift:**
A SwiftUI view specifically designed for rendering to a shareable image. Requirements:
- Fixed frame: width 600, height 315 (1.91:1 ratio for social media)
- Background: AppGradients.celebration (purple gradient)
- Use FIXED font sizes (not Dynamic Type) - this is for image generation
- Layout:
  - "W8Trackr" branding at top (18pt semibold, white 80% opacity)
  - Progress percentage large (72pt bold rounded, white)
  - "of my goal" subtitle (20pt, white 90% opacity)
  - Weight change if `weightChange` is non-nil (24pt medium, white 90% opacity)
    - Format: "+X.X lb" or "-X.X lb" using .number.precision(.fractionLength(1))
  - Duration at bottom (16pt, white 70% opacity)

Properties:
```swift
let progressPercentage: Double
let weightChange: Double?  // nil = privacy mode (hide exact weights)
let duration: String
let unit: WeightUnit
```

Use AppColors.Fallback for any colors (NOT asset catalog colors - they may not resolve in ImageRenderer).

**ProgressImageGenerator.swift:**
@MainActor enum (not struct - static functions only) with:
```swift
static let imageSize = CGSize(width: 600, height: 315)

static func generateProgressImage(
    progressPercentage: Double,
    weightChange: Double,
    duration: String,
    showWeights: Bool,
    unit: WeightUnit
) -> UIImage?
```

Implementation:
1. Create ShareableProgressView with parameters (pass `weightChange: showWeights ? weightChange : nil`)
2. Create ImageRenderer(content: view)
3. Set renderer.scale = UIScreen.main.scale
4. Return renderer.uiImage

Important: Mark as @MainActor - ImageRenderer MUST run on main thread.
  </action>
  <verify>
1. Build succeeds
2. SwiftLint passes: `swiftlint lint --path W8Trackr/Views/Sharing/ --quiet`
  </verify>
  <done>
ShareableProgressView renders at 600x315 with app branding. ProgressImageGenerator uses ImageRenderer at device scale. Privacy mode works (nil weightChange hides values).
  </done>
</task>

</tasks>

<verification>
1. Build succeeds with no errors
2. SwiftLint passes with 0 new violations
3. All 4 files exist in correct locations:
   - W8Trackr/Models/ShareableProgressImage.swift
   - W8Trackr/Models/ShareType.swift
   - W8Trackr/Views/Sharing/ShareableProgressView.swift
   - W8Trackr/Views/Sharing/ProgressImageGenerator.swift
4. ShareableProgressImage conforms to Transferable (DataRepresentation with .png)
5. ProgressImageGenerator marked with @MainActor
</verification>

<success_criteria>
- ShareableProgressImage can be used with ShareLink
- ProgressImageGenerator.generateProgressImage returns non-nil UIImage
- ShareableProgressView displays correctly at 600x315 with gradient background
- Privacy mode hides weight when weightChange is nil
</success_criteria>

<output>
After completion, create `.planning/phases/24-social-sharing/24-01-SUMMARY.md`
</output>
