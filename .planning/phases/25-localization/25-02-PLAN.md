---
phase: 25-localization
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - W8Trackr/InfoPlist.xcstrings
  - W8TrackrWidget/Localizable.xcstrings
  - W8Trackr/Intents/AppShortcuts.swift
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Permission dialogs display in Spanish when device language is Spanish"
    - "Widget text displays in Spanish when device language is Spanish"
    - "Siri responds to Spanish phrases for app shortcuts"
  artifacts:
    - path: "W8Trackr/InfoPlist.xcstrings"
      provides: "Localized permission descriptions"
      contains: "NSHealthShareUsageDescription"
    - path: "W8TrackrWidget/Localizable.xcstrings"
      provides: "Widget string translations"
      contains: "Weight Tracker"
    - path: "W8Trackr/Intents/AppShortcuts.swift"
      provides: "Spanish Siri phrases"
      contains: "Registrar mi peso"
  key_links:
    - from: "W8Trackr/Info.plist"
      to: "W8Trackr/InfoPlist.xcstrings"
      via: "Xcode Info.plist localization"
      pattern: "NSHealthShareUsageDescription"
---

<objective>
Localize Info.plist permission strings, widget text, and Siri shortcut phrases to Spanish.

Purpose: Complete Spanish localization for all user-touchpoints beyond main app UI (LOCL-01)
Output: InfoPlist.xcstrings, widget Localizable.xcstrings, updated AppShortcuts.swift
</objective>

<execution_context>
@~/.claude/agents/gsd-executor.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-localization/25-RESEARCH.md
@.planning/phases/25-localization/25-01-SUMMARY.md
@W8Trackr/Info.plist
@W8Trackr/Intents/AppShortcuts.swift
@W8TrackrWidget/W8TrackrWidget.swift
@W8TrackrWidget/Views/SmallWidgetView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InfoPlist.xcstrings with Spanish permission descriptions</name>
  <files>W8Trackr/InfoPlist.xcstrings</files>
  <action>
Create InfoPlist.xcstrings in W8Trackr target to localize permission dialog strings.

The keys MUST match exactly what's in Info.plist:
- NSUserNotificationUsageDescription
- NSSiriUsageDescription
- NSHealthShareUsageDescription
- NSHealthUpdateUsageDescription

Create InfoPlist.xcstrings (JSON format):
```json
{
  "sourceLanguage" : "en",
  "strings" : {
    "NSUserNotificationUsageDescription" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "We need to send you notifications for daily weight logging reminders."
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Necesitamos enviarle notificaciones para recordatorios diarios de registro de peso."
          }
        }
      }
    },
    "NSSiriUsageDescription" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Use Siri to log your weight and check your progress."
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Use Siri para registrar su peso y verificar su progreso."
          }
        }
      }
    },
    "NSHealthShareUsageDescription" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "W8Trackr reads your weight data from Apple Health to help you track your progress."
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "W8Trackr lee sus datos de peso de Apple Salud para ayudarle a seguir su progreso."
          }
        }
      }
    },
    "NSHealthUpdateUsageDescription" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "W8Trackr saves your weight and body fat entries to Apple Health so all your health data stays in one place."
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "W8Trackr guarda sus entradas de peso y grasa corporal en Apple Salud para que todos sus datos de salud esten en un solo lugar."
          }
        }
      }
    }
  },
  "version" : "1.0"
}
```

Add InfoPlist.xcstrings to W8Trackr target in Xcode project.
  </action>
  <verify>
- File W8Trackr/InfoPlist.xcstrings exists
- Contains all 4 permission keys
- Spanish translations present for each
- Build succeeds
  </verify>
  <done>Info.plist permission strings localized for Spanish</done>
</task>

<task type="auto">
  <name>Task 2: Create widget Localizable.xcstrings with Spanish translations</name>
  <files>W8TrackrWidget/Localizable.xcstrings</files>
  <action>
Create Localizable.xcstrings in the W8TrackrWidget target for widget-specific strings.

Widget strings to localize (from widget views):
- "Weight Tracker" (configurationDisplayName)
- "See your current weight and progress at a glance." (description)
- "W8Trackr" (brand name - mark as non-translatable)
- "Trending up"
- "Trending down"
- "Holding steady"
- "Not enough data"
- "Add your first weight entry in W8Trackr"
- "Progress to Goal"
- "to go"
- "Weight Trend" (large widget title)

Create W8TrackrWidget/Localizable.xcstrings:
```json
{
  "sourceLanguage" : "en",
  "strings" : {
    "Weight Tracker" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Weight Tracker"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Seguimiento de Peso"
          }
        }
      }
    },
    "See your current weight and progress at a glance." : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "See your current weight and progress at a glance."
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Vea su peso actual y progreso de un vistazo."
          }
        }
      }
    },
    "W8Trackr" : {
      "shouldTranslate" : false
    },
    "Trending up" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Trending up"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Tendencia al alza"
          }
        }
      }
    },
    "Trending down" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Trending down"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Tendencia a la baja"
          }
        }
      }
    },
    "Holding steady" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Holding steady"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Estable"
          }
        }
      }
    },
    "Not enough data" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Not enough data"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Datos insuficientes"
          }
        }
      }
    },
    "Add your first weight entry in W8Trackr" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Add your first weight entry in W8Trackr"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Agregue su primera entrada de peso en W8Trackr"
          }
        }
      }
    },
    "Progress to Goal" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Progress to Goal"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Progreso al Objetivo"
          }
        }
      }
    },
    "to go" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "to go"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "restante"
          }
        }
      }
    },
    "Weight Trend" : {
      "localizations" : {
        "en" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Weight Trend"
          }
        },
        "es" : {
          "stringUnit" : {
            "state" : "translated",
            "value" : "Tendencia de Peso"
          }
        }
      }
    }
  },
  "version" : "1.0"
}
```

IMPORTANT: The widget views use computed properties for trendText. Update SmallWidgetView.swift to use String(localized:) for the trend text so it's localizable:

```swift
private var trendText: String {
    switch entry.trend {
    case .up: return String(localized: "Trending up")
    case .down: return String(localized: "Trending down")
    case .neutral: return String(localized: "Holding steady")
    case .unknown: return String(localized: "Not enough data")
    }
}
```

Apply similar changes to any other computed string properties in widget views.
  </action>
  <verify>
- File W8TrackrWidget/Localizable.xcstrings exists
- Widget build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8TrackrWidgetExtension -configuration Debug -sdk iphonesimulator build`
- Widget views use String(localized:) for computed strings
  </verify>
  <done>Widget strings localized for Spanish</done>
</task>

<task type="auto">
  <name>Task 3: Add Spanish Siri phrases to AppShortcuts</name>
  <files>W8Trackr/Intents/AppShortcuts.swift</files>
  <action>
Update AppShortcuts.swift to include Spanish Siri phrases alongside English.

The phrases array accepts LocalizedStringResource, which gets localized automatically. However, for Siri phrase recognition, we need to include Spanish phrases directly in the code.

Update W8TrackrShortcuts in AppShortcuts.swift:

```swift
struct W8TrackrShortcuts: AppShortcutsProvider {
    static var appShortcuts: [AppShortcut] {
        AppShortcut(
            intent: LogWeightIntent(),
            phrases: [
                // English
                "Log my weight in \(.applicationName)",
                "Add weight to \(.applicationName)",
                "Record my weight in \(.applicationName)",
                // Spanish
                "Registrar mi peso en \(.applicationName)",
                "Agregar peso en \(.applicationName)",
                "Anotar mi peso en \(.applicationName)"
            ],
            shortTitle: "Log Weight",
            systemImageName: "scalemass"
        )

        AppShortcut(
            intent: GetWeightTrendIntent(),
            phrases: [
                // English
                "What's my weight trend in \(.applicationName)",
                "How is my weight trending in \(.applicationName)",
                "Show weight trend from \(.applicationName)",
                // Spanish
                "Cual es mi tendencia de peso en \(.applicationName)",
                "Como va mi peso en \(.applicationName)",
                "Mostrar tendencia de peso de \(.applicationName)"
            ],
            shortTitle: "Weight Trend",
            systemImageName: "chart.line.uptrend.xyaxis"
        )

        AppShortcut(
            intent: GetWeightLossIntent(),
            phrases: [
                // English
                "How much have I lost in \(.applicationName)",
                "What's my weight change in \(.applicationName)",
                "How much weight have I lost in \(.applicationName)",
                // Spanish
                "Cuanto he perdido en \(.applicationName)",
                "Cual es mi cambio de peso en \(.applicationName)",
                "Cuanto peso he perdido en \(.applicationName)"
            ],
            shortTitle: "Weight Change",
            systemImageName: "arrow.down.right"
        )
    }
}
```

Also update the dialog responses in the intents to be localized. Change each .result(dialog:) call to use String(localized:):

For LogWeightIntent:
```swift
return .result(dialog: "\(String(localized: "Opening W8Trackr to log your weight"))")
```

For GetWeightTrendIntent dialog responses, use String(localized:) for the static parts:
```swift
// Example pattern - apply to all dialog strings
let needMoreEntries = String(localized: "I need at least 2 weight entries to calculate a trend. Keep logging!")
return .result(dialog: "\(needMoreEntries)")
```

For dynamic strings with interpolation, keep using String(localized:) with interpolation:
```swift
let stableMessage = String(localized: "Your weight has been stable")
// Then build the full message
```

Note: The intent dialogs are complex with dynamic values. For v1, focus on the static parts. The dynamic number formatting already uses locale-aware formatters per CLAUDE.md rules.
  </action>
  <verify>
- AppShortcuts.swift compiles without errors
- Spanish phrases added to all 3 AppShortcuts
- Dialog strings use String(localized:)
- Build succeeds
  </verify>
  <done>Siri shortcuts support Spanish phrases and localized dialogs</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Main app build succeeds with InfoPlist.xcstrings
2. Widget build succeeds with its Localizable.xcstrings
3. AppShortcuts.swift compiles with Spanish phrases
4. All localization files contain Spanish translations
</verification>

<success_criteria>
- InfoPlist.xcstrings contains all 4 permission strings in Spanish
- W8TrackrWidget/Localizable.xcstrings contains widget strings in Spanish
- AppShortcuts.swift includes Spanish Siri phrases
- All builds succeed without localization warnings
</success_criteria>

<output>
After completion, create `.planning/phases/25-localization/25-02-SUMMARY.md`
</output>
