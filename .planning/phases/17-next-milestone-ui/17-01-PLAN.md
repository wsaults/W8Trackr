---
phase: 17-next-milestone-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Views/Goals/MilestoneProgressView.swift
autonomous: true

must_haves:
  truths:
    - "Progress bar fills left-to-right as user loses weight toward milestone"
    - "Visual design uses AppColors and AppGradients for theme consistency"
    - "Card styling matches app design language (surface background, cardShadow, corner radius)"
    - "VoiceOver announces progress toward next milestone"
  artifacts:
    - path: "W8Trackr/Views/Goals/MilestoneProgressView.swift"
      provides: "Linear progress bar milestone views"
      contains: "Capsule"
  key_links:
    - from: "MilestoneProgressView"
      to: "AppGradients.progressPositive"
      via: "progress bar fill"
      pattern: "AppGradients\\.progressPositive"
    - from: "MilestoneProgressView"
      to: "AppColors.surface"
      via: "card background"
      pattern: "AppColors\\.surface"
---

<objective>
Replace circular progress rings with linear horizontal progress bars in MilestoneProgressView and MilestoneProgressCompactView.

Purpose: The current circular progress ring doesn't clearly communicate "progress toward goal." A left-to-right linear bar visually represents the journey from starting point to milestone target.

Output: Redesigned milestone progress views using capsule-based progress bars with proper theming and accessibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-next-milestone-ui/17-RESEARCH.md
@W8Trackr/Views/Goals/MilestoneProgressView.swift
@W8Trackr/Theme/Colors.swift
@W8Trackr/Theme/Gradients.swift
@W8Trackr/Theme/AppTheme.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign MilestoneProgressView with linear progress bar</name>
  <files>W8Trackr/Views/Goals/MilestoneProgressView.swift</files>
  <action>
Replace the circular progress ring in MilestoneProgressView with a horizontal linear progress bar:

1. **Replace circular ZStack with linear progress bar:**
   - Remove the Circle().stroke() track and Circle().trim() progress arc
   - Create progressBar computed property using GeometryReader:
     ```swift
     private var progressBar: some View {
         GeometryReader { geometry in
             ZStack(alignment: .leading) {
                 // Background track
                 Capsule()
                     .fill(AppColors.surfaceSecondary)
                 // Filled progress
                 Capsule()
                     .fill(AppGradients.progressPositive)
                     .frame(width: max(0, geometry.size.width * animatedProgress))
             }
         }
         .frame(height: barHeight)
     }
     ```
   - Add `@ScaledMetric(relativeTo: .body) private var barHeight: CGFloat = 12`

2. **Update layout to card-style design:**
   - Header row: "Next Milestone" label left, milestone weight + unit right
   - Progress bar in middle
   - Labels row below: previous milestone left, "X.X lb/kg to go" center, next milestone right

3. **Fix card styling:**
   - Replace `Color(UIColor.systemBackground)` with `AppColors.surface`
   - Replace `.clipShape(.rect(cornerRadius: 10))` with `.clipShape(RoundedRectangle(cornerRadius: AppTheme.CornerRadius.md))`
   - Add `.cardShadow()` modifier after clipShape

4. **Keep existing animation logic:**
   - Preserve onAppear and onChange(of:) animations for animatedProgress
   - Preserve onMilestoneReached callback when progress >= 1.0
  </action>
  <verify>
Build succeeds with: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build 2>&1 | tail -5`
  </verify>
  <done>MilestoneProgressView displays horizontal progress bar that fills left-to-right, uses AppColors/AppGradients, has card styling with shadow</done>
</task>

<task type="auto">
  <name>Task 2: Update MilestoneProgressCompactView and add accessibility</name>
  <files>W8Trackr/Views/Goals/MilestoneProgressView.swift</files>
  <action>
1. **Update MilestoneProgressCompactView to use linear bar:**
   - Remove mini circular ring (ZStack with Circle())
   - Replace with inline progress bar:
     ```swift
     // Compact progress bar (no GeometryReader needed, simpler)
     GeometryReader { geometry in
         ZStack(alignment: .leading) {
             Capsule()
                 .fill(AppColors.surfaceSecondary)
             Capsule()
                 .fill(AppColors.primary)
                 .frame(width: geometry.size.width * progress.progressToNextMilestone)
         }
     }
     .frame(height: 6)
     ```
   - Keep existing text layout (weight to go, goal label)

2. **Fix card styling in compact view:**
   - Replace `Color(UIColor.systemBackground)` with `AppColors.surface`
   - Replace `.clipShape(.rect(cornerRadius: 10))` with `.clipShape(RoundedRectangle(cornerRadius: AppTheme.CornerRadius.md))`
   - Add `.cardShadow()` modifier

3. **Add accessibility to MilestoneProgressView:**
   - Add to the outer VStack:
     ```swift
     .accessibilityElement(children: .combine)
     .accessibilityLabel("Next milestone \(Int(progress.nextMilestone)) \(progress.unit.rawValue). \(Int(animatedProgress * 100)) percent complete. \(progress.weightToNextMilestone.formatted(.number.precision(.fractionLength(1)))) \(progress.unit.rawValue) remaining.")
     ```

4. **Add accessibility to MilestoneProgressCompactView:**
   - Add similar accessibility label to the outer HStack

5. **Update previews** to verify both views render correctly
  </action>
  <verify>
Run SwiftLint: `cd /Users/will/Projects/Saults/W8Trackr && swiftlint lint --path W8Trackr/Views/Goals/MilestoneProgressView.swift 2>&1 | grep -E "(warning|error)" | head -10` (expect 0 violations)
Build and test: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -sdk iphonesimulator build 2>&1 | tail -5`
  </verify>
  <done>Both MilestoneProgressView and MilestoneProgressCompactView use linear horizontal progress bars, proper theming, and VoiceOver accessibility labels</done>
</task>

</tasks>

<verification>
1. Build succeeds with zero errors
2. SwiftLint passes with zero warnings
3. Preview shows progress bar filling left-to-right
4. Card has consistent styling: AppColors.surface background, cardShadow, rounded corners
5. VoiceOver announces: "Next milestone [X] [unit]. [Y] percent complete. [Z] [unit] remaining."
</verification>

<success_criteria>
- Progress bar fills left-to-right (not circular, not right-to-left)
- Visual design uses established design system (AppColors, AppGradients, AppTheme)
- Card styling matches other dashboard cards (surface, shadow, corner radius)
- Both full and compact variants updated consistently
- Accessibility labels provide meaningful progress information
</success_criteria>

<output>
After completion, create `.planning/phases/17-next-milestone-ui/17-01-SUMMARY.md`
</output>
