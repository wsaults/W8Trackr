---
phase: 02-chart-animation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Views/WeightTrendChartView.swift
autonomous: false

must_haves:
  truths:
    - "Chart line animates smoothly when switching between date segments"
    - "No visual jank, squiggling, or jittering during animation"
    - "Chart displays correct data after animation completes"
  artifacts:
    - path: "W8Trackr/Views/WeightTrendChartView.swift"
      provides: "ChartEntry with stable date-based identity"
      contains: "var id:"
  key_links:
    - from: "ChartEntry.id"
      to: "ChartEntry.date"
      via: "computed property deriving ID from timestamp + type"
      pattern: "var id.*date\\.timeIntervalSince1970"
---

<objective>
Fix chart animation jank by replacing UUID-based identity with stable date-based identity in ChartEntry struct.

Purpose: When users change date range segments (1W, 1M, 3M, etc.), the chart line should animate smoothly. Currently it squiggles/jitters because ChartEntry uses `let id = UUID()` which generates new IDs every time the chartData computed property is accessed, causing SwiftUI to see entirely new data instead of animating existing points.

Output: Smooth chart animations when changing date ranges, matching user expectations for polished iOS apps.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-chart-animation/02-RESEARCH.md
@W8Trackr/Views/WeightTrendChartView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace UUID identity with date-based stable identity</name>
  <files>W8Trackr/Views/WeightTrendChartView.swift</files>
  <action>
Modify the ChartEntry struct (around line 102-110) to use a computed `id` property based on date and entry type instead of `let id = UUID()`.

Replace:
```swift
private struct ChartEntry: Identifiable {
    let id = UUID()
    let date: Date
    // ... rest of properties
}
```

With:
```swift
private struct ChartEntry: Identifiable {
    var id: String {
        let timestamp = Int(date.timeIntervalSince1970)
        if isSmoothed {
            return "smoothed-\(timestamp)"
        } else if isPrediction {
            return "prediction-\(timestamp)"
        } else {
            return "entry-\(timestamp)"
        }
    }

    let date: Date
    // ... rest of properties unchanged
}
```

The key insight: SwiftUI uses the `id` to track items across state changes. With UUID(), each access to `chartData` creates new UUIDs, so SwiftUI sees 100% new items and cannot animate between old and new positions. With date-based IDs, the same data point keeps the same ID, allowing SwiftUI to interpolate between positions.

This pattern is already used successfully in `TrendCalculator.swift` where `TrendPoint` uses `var id: Date { date }`.
  </action>
  <verify>
1. Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
2. ChartEntry no longer contains `let id = UUID()`
3. ChartEntry contains computed `var id:` property using date.timeIntervalSince1970
  </verify>
  <done>ChartEntry struct uses stable date-based identity that persists across chartData recalculations</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify smooth chart animation</name>
  <what-built>
Chart animation fix using stable date-based identity for ChartEntry. The change allows SwiftUI to properly track chart data points across date range changes, enabling smooth interpolation instead of treating each change as entirely new data.
  </what-built>
  <how-to-verify>
1. Run the app in simulator or device
2. Navigate to the weight chart (Dashboard or Summary view)
3. Ensure you have at least a few weight entries spanning several weeks
4. Tap through the date range segments: 1W -> 1M -> 3M -> 6M -> 1Y -> All
5. Observe the chart line animation as you switch segments

**Expected behavior:**
- Chart line animates smoothly, points move to new positions
- No squiggling, jittering, or visual artifacts
- Animation feels natural and polished

**Previous broken behavior (should NOT happen):**
- Chart line squiggles or jitters during transition
- Points appear to jump randomly before settling
- Visual "noise" during the animation

6. Toggle smoothing on/off while changing date ranges to ensure both smoothed and raw views animate correctly
7. Verify data accuracy: check that the actual weight values displayed match your entries (no data corruption from the ID change)
  </how-to-verify>
  <resume-signal>Type "approved" if animations are smooth, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
- Build passes without errors or warnings related to ChartEntry
- ChartEntry.id is computed from date + type, not UUID
- Manual testing confirms smooth animations when changing date ranges
</verification>

<success_criteria>
1. Chart line animates smoothly when switching between any date segments (1W, 1M, 3M, 6M, 1Y, All)
2. No visual jank, squiggling, or jittering during animation
3. Chart displays correct weight data after animation completes
4. Both smoothed trend line and individual data points animate correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-chart-animation/02-01-SUMMARY.md`
</output>
