---
phase: 13-app-store-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Info.plist
  - fastlane/Snapfile
  - fastlane/Fastfile
  - .github/workflows/test.yml
autonomous: true

must_haves:
  truths:
    - "App Store submissions bypass export compliance questionnaire"
    - "CI pipeline catches SwiftLint violations before merge"
    - "Screenshot capture targets 2026 mandatory device sizes"
  artifacts:
    - path: "W8Trackr/Info.plist"
      provides: "Export compliance declaration"
      contains: "ITSAppUsesNonExemptEncryption"
    - path: "fastlane/Snapfile"
      provides: "Screenshot device configuration"
      contains: "iPhone 16 Pro Max"
    - path: "fastlane/Fastfile"
      provides: "Fastlane lane definitions"
      contains: "iPhone 16 Pro Max"
    - path: ".github/workflows/test.yml"
      provides: "CI pipeline with linting"
      contains: "swiftlint"
  key_links:
    - from: "fastlane/Snapfile"
      to: "fastlane/Fastfile"
      via: "matching device lists"
      pattern: "iPhone 16 Pro Max"
    - from: ".github/workflows/test.yml"
      to: "SwiftLint"
      via: "brew install + lint command"
      pattern: "swiftlint lint"
---

<objective>
Complete App Store automation configuration by adding export compliance declaration, updating screenshot device targets for 2026 requirements, and adding SwiftLint to CI pipeline.

Purpose: Enable streamlined App Store submissions without manual compliance questionnaires and ensure consistent code quality enforcement.
Output: Updated Info.plist, Snapfile, Fastfile, and test.yml ready for automated App Store workflows.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-app-store-automation/13-RESEARCH.md

# Files to modify
@W8Trackr/Info.plist
@fastlane/Snapfile
@fastlane/Fastfile
@.github/workflows/test.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add export compliance key to Info.plist</name>
  <files>W8Trackr/Info.plist</files>
  <action>
Add ITSAppUsesNonExemptEncryption key with value NO (false) to Info.plist.

This declares that the app only uses standard HTTPS encryption (via URLSession) and does not require export compliance documentation. W8Trackr uses standard iOS networking APIs only - no custom cryptography.

Add after the existing keys:
```xml
<key>ITSAppUsesNonExemptEncryption</key>
<false/>
```

Reference: https://developer.apple.com/documentation/bundleresources/information-property-list/itsappusesnonexemptencryption
  </action>
  <verify>
Verify key exists in Info.plist:
```bash
grep -A1 "ITSAppUsesNonExemptEncryption" W8Trackr/Info.plist
```
Should show the key followed by `<false/>`.
  </verify>
  <done>Info.plist contains ITSAppUsesNonExemptEncryption = false, enabling automated export compliance bypass during App Store submission.</done>
</task>

<task type="auto">
  <name>Task 2: Update screenshot device targets for 2026 requirements</name>
  <files>fastlane/Snapfile, fastlane/Fastfile</files>
  <action>
Update both Snapfile and Fastfile device lists to target 2026 App Store mandatory screenshot sizes:

**2026 Requirements (from Apple Screenshot Specifications):**
- 6.9" display (1320 x 2868 px) - iPhone 16 Pro Max - MANDATORY
- 6.5" display (1284 x 2778 px) - iPhone 14 Plus - Fallback option
- 13" display (2064 x 2752 px) - iPad Pro 13-inch (M4) - MANDATORY for iPad apps

**In Snapfile**, update the devices array:
```ruby
devices([
  "iPhone 16 Pro Max",              # 6.9" - mandatory size
  "iPhone 14 Plus",                 # 6.5" - fallback option
  "iPad Pro 13-inch (M4)"           # 13" - mandatory for iPad
])
```

Update the comment above to reflect 2026 requirements.

**In Fastfile**, update the screenshots lane devices array to match:
```ruby
devices: [
  "iPhone 16 Pro Max",
  "iPhone 14 Plus",
  "iPad Pro 13-inch (M4)"
],
```

Also update the test lane device from "iPhone 17" to "iPhone 16 Pro Max" (iPhone 17 doesn't exist yet).

IMPORTANT: Keep both files in sync - same device list in both places.
  </action>
  <verify>
Verify devices match in both files:
```bash
grep -A3 "devices" fastlane/Snapfile
grep -A5 "devices:" fastlane/Fastfile
```
Both should show iPhone 16 Pro Max, iPhone 14 Plus, iPad Pro 13-inch (M4).

Verify test lane device:
```bash
grep "device:" fastlane/Fastfile
```
Should show "iPhone 16 Pro Max".
  </verify>
  <done>Snapfile and Fastfile target 2026 mandatory screenshot sizes (6.9" iPhone and 13" iPad) with matching device configurations.</done>
</task>

<task type="auto">
  <name>Task 3: Add SwiftLint to CI workflow</name>
  <files>.github/workflows/test.yml</files>
  <action>
Add SwiftLint step to the GitHub Actions test workflow to enforce code quality on every push and PR.

Add a new step AFTER "Show Xcode version" and BEFORE "Set up Ruby":

```yaml
- name: Install SwiftLint
  run: brew install swiftlint

- name: Run SwiftLint
  run: swiftlint lint --strict --reporter github-actions-logging
```

**Why this placement:**
- After Xcode selection (SwiftLint may need build tools)
- Before Ruby setup (fail fast on lint errors, save CI time)

**Flags explained:**
- `--strict`: Treat warnings as errors (enforce quality)
- `--reporter github-actions-logging`: Show lint errors as GitHub annotations in PR diff view

This ensures code quality is enforced before tests run, failing the build early on style violations.
  </action>
  <verify>
Verify workflow has SwiftLint steps:
```bash
grep -A2 "SwiftLint" .github/workflows/test.yml
```
Should show both "Install SwiftLint" and "Run SwiftLint" steps with brew install and lint commands.
  </verify>
  <done>CI workflow runs SwiftLint with strict mode before tests, providing early code quality feedback with GitHub PR annotations.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Export compliance:** `grep ITSAppUsesNonExemptEncryption W8Trackr/Info.plist` shows the key
2. **Device sync:** Device lists match between Snapfile and Fastfile (iPhone 16 Pro Max, iPhone 14 Plus, iPad Pro 13-inch)
3. **CI linting:** test.yml contains SwiftLint installation and execution steps
4. **Syntax validation:**
   - `plutil -lint W8Trackr/Info.plist` returns valid
   - `ruby -c fastlane/Fastfile` returns valid
   - No YAML syntax errors in test.yml
</verification>

<success_criteria>
- ITSAppUsesNonExemptEncryption = false in Info.plist (export compliance bypass enabled)
- Snapfile and Fastfile target iPhone 16 Pro Max (6.9"), iPhone 14 Plus (6.5"), iPad Pro 13-inch (M4)
- test.yml includes SwiftLint installation and strict lint check before test execution
- All modified files pass syntax validation
</success_criteria>

<output>
After completion, create `.planning/phases/13-app-store-automation/13-01-SUMMARY.md`
</output>
