---
phase: 09-milestone-intervals
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Models/Milestone.swift
  - W8Trackr/Views/SettingsView.swift
  - W8Trackr/Views/ContentView.swift
  - W8Trackr/Views/Dashboard/DashboardView.swift
  - W8Trackr/Views/SummaryView.swift
autonomous: true

must_haves:
  truths:
    - "User can select milestone interval (5, 10, or 15 lbs) in Settings"
    - "Milestone progress ring reflects chosen interval"
    - "New milestones are calculated at chosen interval"
    - "Setting persists across app launches"
    - "Default is 5 lbs (current behavior)"
  artifacts:
    - path: "W8Trackr/Models/Milestone.swift"
      provides: "MilestoneInterval enum with five/ten/fifteen cases"
      contains: "enum MilestoneInterval"
    - path: "W8Trackr/Views/SettingsView.swift"
      provides: "Milestone interval picker section"
      contains: "milestoneInterval"
  key_links:
    - from: "W8Trackr/Views/ContentView.swift"
      to: "W8Trackr/Views/Dashboard/DashboardView.swift"
      via: "@AppStorage -> parameter"
      pattern: "milestoneInterval.*DashboardView"
    - from: "W8Trackr/Views/Dashboard/DashboardView.swift"
      to: "MilestoneCalculator"
      via: "parameter to generateMilestones and calculateProgress"
      pattern: "intervalPreference|milestoneInterval"
---

<objective>
Add configurable milestone celebration intervals so users can choose when they receive milestone celebrations (every 5, 10, or 15 lbs of progress).

Purpose: Allow users to customize milestone frequency based on their goals - some prefer frequent encouragement (5 lb), others prefer fewer but more significant celebrations (15 lb).

Output: MilestoneInterval enum, updated MilestoneCalculator, Settings UI, and threaded preference through view hierarchy.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-milestone-intervals/09-RESEARCH.md

# Key source files
@W8Trackr/Models/Milestone.swift
@W8Trackr/Models/WeightEntry.swift
@W8Trackr/Views/SettingsView.swift
@W8Trackr/Views/ContentView.swift
@W8Trackr/Views/Dashboard/DashboardView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MilestoneInterval enum and update MilestoneCalculator</name>
  <files>W8Trackr/Models/Milestone.swift</files>
  <action>
Add `MilestoneInterval` enum at the top of Milestone.swift (before CompletedMilestone):

```swift
/// Configurable interval for milestone celebrations
enum MilestoneInterval: String, CaseIterable {
    case five = "5"
    case ten = "10"
    case fifteen = "15"

    /// Interval value in pounds
    var pounds: Double {
        switch self {
        case .five: return 5.0
        case .ten: return 10.0
        case .fifteen: return 15.0
        }
    }

    /// Interval value in kilograms (rounded for clean UX)
    var kilograms: Double {
        switch self {
        case .five: return 2.0    // ~2.27 kg
        case .ten: return 5.0     // ~4.54 kg
        case .fifteen: return 7.0 // ~6.80 kg
        }
    }

    /// Get interval value for the specified unit
    func value(for unit: WeightUnit) -> Double {
        switch unit {
        case .lb: return pounds
        case .kg: return kilograms
        }
    }

    /// Display label showing value and unit
    func displayLabel(for unit: WeightUnit) -> String {
        let value = Int(self.value(for: unit))
        return "\(value) \(unit.rawValue)"
    }
}
```

Update `MilestoneCalculator.interval(for:)` to accept preference parameter:

```swift
/// Milestone interval by unit, using user preference
static func interval(for unit: WeightUnit, preference: MilestoneInterval = .five) -> Double {
    preference.value(for: unit)
}
```

Update `MilestoneCalculator.generateMilestones()` signature:

```swift
static func generateMilestones(
    startWeight: Double,
    goalWeight: Double,
    unit: WeightUnit,
    intervalPreference: MilestoneInterval = .five
) -> [Double] {
    let interval = interval(for: unit, preference: intervalPreference)
    // ... rest unchanged
}
```

Update `MilestoneCalculator.calculateProgress()` signature:

```swift
static func calculateProgress(
    currentWeight: Double,
    startWeight: Double,
    goalWeight: Double,
    unit: WeightUnit,
    completedMilestones: [CompletedMilestone],
    intervalPreference: MilestoneInterval = .five
) -> MilestoneProgress {
    let allMilestones = generateMilestones(
        startWeight: startWeight,
        goalWeight: goalWeight,
        unit: unit,
        intervalPreference: intervalPreference
    )
    // ... rest unchanged
}
```

Default values ensure backward compatibility - existing callers without the parameter continue to work.
  </action>
  <verify>Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`</verify>
  <done>MilestoneInterval enum exists with five/ten/fifteen cases, MilestoneCalculator accepts interval preference with default of .five</done>
</task>

<task type="auto">
  <name>Task 2: Thread milestone interval preference through view hierarchy</name>
  <files>W8Trackr/Views/ContentView.swift, W8Trackr/Views/Dashboard/DashboardView.swift, W8Trackr/Views/SummaryView.swift</files>
  <action>
**ContentView.swift:**
Add @AppStorage after existing preferences:

```swift
@AppStorage("milestoneInterval") var milestoneInterval: MilestoneInterval = .five
```

Pass to DashboardView:

```swift
DashboardView(
    entries: entries,
    completedMilestones: completedMilestones,
    preferredWeightUnit: preferredWeightUnit,
    goalWeight: goalWeight,
    showSmoothing: showSmoothing,
    milestoneInterval: milestoneInterval  // NEW
)
```

**DashboardView.swift:**
Add property after `showSmoothing`:

```swift
var milestoneInterval: MilestoneInterval
```

Update `milestoneProgress` computed property:

```swift
private var milestoneProgress: MilestoneProgress? {
    guard !entries.isEmpty else { return nil }
    return MilestoneCalculator.calculateProgress(
        currentWeight: currentWeight,
        startWeight: startWeight,
        goalWeight: goalWeight,
        unit: preferredWeightUnit,
        completedMilestones: completedMilestones,
        intervalPreference: milestoneInterval  // NEW
    )
}
```

Update `checkForNewMilestone()` call to `generateMilestones`:

```swift
let allMilestones = MilestoneCalculator.generateMilestones(
    startWeight: startWeight,
    goalWeight: goalWeight,
    unit: preferredWeightUnit,
    intervalPreference: milestoneInterval  // NEW
)
```

Update previews to include `milestoneInterval: .five`.

**SummaryView.swift:**
Add property after `showSmoothing`:

```swift
var milestoneInterval: MilestoneInterval
```

Update `milestoneProgress` computed property to pass `intervalPreference: milestoneInterval`.

Update `checkForNewMilestone()` call to `generateMilestones` to pass `intervalPreference: milestoneInterval`.

Update previews to include `milestoneInterval: .five`.

Note: SummaryView is not used in main navigation (DashboardView is) but keeping it in sync for consistency.
  </action>
  <verify>Build succeeds with no errors</verify>
  <done>milestoneInterval flows from ContentView @AppStorage through DashboardView and SummaryView to MilestoneCalculator</done>
</task>

<task type="auto">
  <name>Task 3: Add milestone interval picker to Settings</name>
  <files>W8Trackr/Views/SettingsView.swift</files>
  <action>
Add binding property alongside existing bindings:

```swift
@Binding var milestoneInterval: MilestoneInterval
```

Update init to accept the binding:

```swift
init(weightUnit: Binding<WeightUnit>, goalWeight: Binding<Double>, showSmoothing: Binding<Bool>, milestoneInterval: Binding<MilestoneInterval>) {
    _weightUnit = weightUnit
    _goalWeight = goalWeight
    _showSmoothing = showSmoothing
    _milestoneInterval = milestoneInterval
    _reminderTime = State(initialValue: NotificationManager.getReminderTime())
}
```

Add section view after `chartSettingsSection`:

```swift
private var milestoneSection: some View {
    Section {
        Picker("Celebration Interval", selection: $milestoneInterval) {
            ForEach(MilestoneInterval.allCases, id: \.self) { interval in
                Text(interval.displayLabel(for: weightUnit))
            }
        }
        .pickerStyle(.segmented)
    } header: {
        Text("Milestones")
    } footer: {
        Text("Celebrate every \(milestoneInterval.displayLabel(for: weightUnit)) of progress toward your goal.")
    }
}
```

Add to body Form after `chartSettingsSection`:

```swift
Form {
    weightSettingsSection
    chartSettingsSection
    milestoneSection  // NEW - after chart settings
    reminderSection
    // ... rest unchanged
}
```

Update previews to include `milestoneInterval` binding.

**ContentView.swift (additional):**
Update SettingsView call to pass binding:

```swift
SettingsView(
    weightUnit: $preferredWeightUnit,
    goalWeight: $goalWeight,
    showSmoothing: $showSmoothing,
    milestoneInterval: $milestoneInterval  // NEW
)
```
  </action>
  <verify>
1. Build succeeds
2. Run in simulator, navigate to Settings
3. Verify "Milestones" section appears with segmented picker showing "5 lb", "10 lb", "15 lb"
4. Changing selection updates footer text dynamically
5. Kill app, relaunch, verify selection persists
  </verify>
  <done>Settings shows Milestones section with 3-option segmented picker, footer shows current selection, setting persists</done>
</task>

</tasks>

<verification>
1. Build: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
2. SwiftLint: `swiftlint` returns 0 violations
3. Functional test in simulator:
   - Settings shows Milestones picker with 5/10/15 lb options
   - Default is 5 lb
   - Changing to 10 lb and logging weight near a 10 lb milestone triggers celebration
   - Setting persists after app restart
</verification>

<success_criteria>
- MilestoneInterval enum exists with .five, .ten, .fifteen cases
- MilestoneCalculator accepts intervalPreference parameter (default .five)
- @AppStorage("milestoneInterval") persists user choice
- Settings shows segmented picker for interval selection
- Dashboard uses selected interval for milestone calculations
- Default behavior unchanged (5 lb intervals)
- Build passes, SwiftLint passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-milestone-intervals/09-01-SUMMARY.md`
</output>
