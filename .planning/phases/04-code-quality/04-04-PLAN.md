---
phase: 04-code-quality
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Preview Content/PreviewModifiers.swift
  - W8Trackr/Views/ToastView.swift
  - W8Trackr/Views/HistorySectionView.swift
  - W8TrackrTests/W8TrackrTests.swift
  - W8TrackrTests/WeightUnitTests.swift
  - W8TrackrTests/WeightEntryTests.swift
  - W8TrackrTests/ChartDataTests.swift
  - W8TrackrTests/NotificationTests.swift
  - W8TrackrTests/DataExporterTests.swift
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "SwiftLint passes with zero warnings"
    - "No print statements in production code"
    - "No redundant_discardable_let violations"
    - "Test file under 1000 lines"
  artifacts:
    - path: "W8Trackr/Preview Content/PreviewModifiers.swift"
      provides: "Preview modifiers without let _ = pattern"
    - path: "W8Trackr/Views/ToastView.swift"
      provides: "Toast view without print statements"
    - path: "W8Trackr/Views/HistorySectionView.swift"
      provides: "History view without print statements"
    - path: "W8TrackrTests/W8TrackrTests.swift"
      provides: "Main test file under 1000 lines"
  key_links: []
---

<objective>
Fix all SwiftLint violations to achieve zero warnings

Purpose: Truth #4 ("SwiftLint passes with zero warnings") is currently failed with 8 violations. This blocks phase completion.

Output: Clean SwiftLint run with zero warnings/errors
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-code-quality/04-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix redundant_discardable_let and print statement violations</name>
  <files>W8Trackr/Preview Content/PreviewModifiers.swift, W8Trackr/Views/ToastView.swift, W8Trackr/Views/HistorySectionView.swift</files>
  <action>
    Fix 7 SwiftLint warnings:

    1. PreviewModifiers.swift - redundant_discardable_let (lines 163, 228):
       - Line 163: Change `let _ = { ... }()` to `_ = { ... }()`
       - Line 228: Change `let _ = { ... }()` to `_ = { ... }()`
       The `let` is redundant when using `_` as a discard pattern.

    2. ToastView.swift - no_print_statements (lines 257, 284):
       These are in #Preview blocks (debug-only code). Remove the print statements:
       - Line 257: Remove `print("Retry tapped")` or replace with empty closure body `{}`
       - Line 284: Remove `print("Undo tapped")` or replace with empty closure body `{}`

    3. HistorySectionView.swift - no_print_statements (lines 172, 206, 232):
       - Line 172: Remove `print("HealthKit delete failed...")`
         This is in a catch block - keep the catch but remove print. Error is already handled by continuing without blocking local delete.
       - Lines 206, 232: These are in #Preview blocks - remove print statements or use empty closure.
  </action>
  <verify>
    swiftlint lint --path W8Trackr/Preview\ Content/PreviewModifiers.swift --path W8Trackr/Views/ToastView.swift --path W8Trackr/Views/HistorySectionView.swift
    Expected: No violations in these files
  </verify>
  <done>Zero SwiftLint violations in PreviewModifiers.swift, ToastView.swift, HistorySectionView.swift</done>
</task>

<task type="auto">
  <name>Task 2: Split W8TrackrTests.swift to fix file_length error</name>
  <files>W8TrackrTests/W8TrackrTests.swift, W8TrackrTests/WeightUnitTests.swift, W8TrackrTests/WeightEntryTests.swift, W8TrackrTests/ChartDataTests.swift, W8TrackrTests/NotificationTests.swift, W8TrackrTests/DataExporterTests.swift</files>
  <action>
    Split W8TrackrTests.swift (1673 lines) into multiple files to get under 1000 line limit.

    Current structure (line numbers from grep):
    - WeightUnitTests (line 14)
    - WeightValidationBoundaryTests (line 82)
    - WeightConversionPrecisionTests (line 213)
    - WeightConversionTests (line 261)
    - WeightConversionBoundaryTests (line 315)
    - WeightEntryTests (line 453)
    - DateRangeTests (line 511)
    - GoalWeightValidationTests (line 544)
    - GoalSpecificWeightValidationTests (line 571)
    - ChartDataFilteringTests (line 665)
    - DailyAverageTests (line 748)
    - PredictionCalculationTests (line 797)
    - NotificationSchedulerTests (line 911)
    - DataExporterTests (line 1131)
    - ExportFormatTests (line 1295)
    - JSONExportTests (line 1321)
    - SampleDataTests (line 1448)
    - TrendCalculatorTests (line 1480) - NOTE: Already has separate file TrendCalculatorTests.swift

    Split strategy (target ~300-500 lines each):

    1. **WeightUnitTests.swift** (new file):
       - Move: WeightUnitTests, WeightValidationBoundaryTests, WeightConversionPrecisionTests, WeightConversionTests, WeightConversionBoundaryTests
       - Lines 14-450 (~436 lines)

    2. **WeightEntryTests.swift** (new file):
       - Move: WeightEntryTests, DateRangeTests, GoalWeightValidationTests, GoalSpecificWeightValidationTests
       - Lines 453-662 (~210 lines)

    3. **ChartDataTests.swift** (new file):
       - Move: ChartDataFilteringTests, DailyAverageTests, PredictionCalculationTests
       - Lines 665-908 (~244 lines)

    4. **NotificationTests.swift** (new file):
       - Move: NotificationSchedulerTests
       - Lines 911-1128 (~218 lines)

    5. **DataExporterTests.swift** (new file):
       - Move: DataExporterTests, ExportFormatTests, JSONExportTests, SampleDataTests
       - Lines 1131-1475 (~345 lines)

    6. **W8TrackrTests.swift** (keep minimal):
       - Keep only imports and file header comment
       - Remove TrendCalculatorTests reference (already in separate file)
       - Remaining: ~10-20 lines (or delete entirely if empty)

    Each new file needs:
    ```swift
    import Testing
    import Foundation
    @testable import W8Trackr
    ```

    IMPORTANT: TrendCalculatorTests.swift already exists - do NOT create duplicate. Remove TrendCalculatorTests struct from W8TrackrTests.swift if present.
  </action>
  <verify>
    wc -l W8TrackrTests/*.swift
    Expected: All files under 1000 lines, W8TrackrTests.swift significantly smaller or removed
  </verify>
  <done>Test files split into logical groups, all under 1000 lines</done>
</task>

<task type="auto">
  <name>Task 3: Verify SwiftLint passes</name>
  <files>N/A</files>
  <action>
    Run full SwiftLint check on the project:

    swiftlint lint

    Expected output: No warnings, no errors.

    If any violations remain, fix them before completing.
  </action>
  <verify>
    swiftlint lint | grep -c "warning\|error" returns 0
    OR swiftlint lint shows "Done linting" with no issues
  </verify>
  <done>SwiftLint passes with zero warnings and zero errors</done>
</task>

</tasks>

<verification>
1. `swiftlint lint` returns zero violations
2. `wc -l W8TrackrTests/*.swift` shows all files under 1000 lines
3. `grep "print(" W8Trackr/Views/*.swift` returns only acceptable debug/preview code
4. `grep "let _ =" W8Trackr/**/*.swift` returns no redundant discardable let patterns
</verification>

<success_criteria>
- SwiftLint passes with zero warnings (Truth #4 satisfied)
- No print statements in production code paths
- All test files under 1000 lines
- Build and tests still pass after changes
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-quality/04-04-SUMMARY.md`
</output>
