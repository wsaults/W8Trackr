---
phase: 20-full-accessibility-support
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Views/Goals/MilestoneCelebrationView.swift
  - W8Trackr/Views/Animations/SparkleView.swift
  - W8Trackr/Views/Animations/AnimationModifiers.swift
  - W8Trackr/Views/Onboarding/OnboardingView.swift
  - W8Trackr/Views/ToastView.swift
autonomous: true

must_haves:
  truths:
    - "Decorative animations are disabled when Reduce Motion is enabled"
    - "Confetti cannons do not fire when Reduce Motion is enabled"
    - "Spring animations use nil animation or instant transitions when Reduce Motion is enabled"
    - "Repeating/infinite animations are disabled when Reduce Motion is enabled"
    - "Essential navigation animations remain functional"
  artifacts:
    - path: "W8Trackr/Views/Goals/MilestoneCelebrationView.swift"
      provides: "Reduce Motion-aware milestone celebration"
      contains: "accessibilityReduceMotion"
    - path: "W8Trackr/Views/Animations/SparkleView.swift"
      provides: "Reduce Motion-aware sparkle/glow effects"
      contains: "accessibilityReduceMotion"
    - path: "W8Trackr/Views/Animations/AnimationModifiers.swift"
      provides: "Reduce Motion-aware animation modifiers"
      contains: "accessibilityReduceMotion"
    - path: "W8Trackr/Views/Onboarding/OnboardingView.swift"
      provides: "Reduce Motion-aware onboarding confetti"
      contains: "accessibilityReduceMotion"
  key_links:
    - from: "MilestoneCelebrationView"
      to: "Environment accessibilityReduceMotion"
      via: "@Environment property wrapper"
      pattern: "@Environment\\(\\.accessibilityReduceMotion\\)"
    - from: "SparkleView"
      to: "Environment accessibilityReduceMotion"
      via: "@Environment property wrapper"
      pattern: "@Environment\\(\\.accessibilityReduceMotion\\)"
---

<objective>
Add Reduce Motion support to all decorative animations throughout the app.

Purpose: Users with vestibular disorders can experience motion sickness from animations. iOS provides `accessibilityReduceMotion` environment value that apps must respect for WCAG compliance.

Output: All decorative animations (confetti, sparkles, spring effects, pulsing, bouncing) are disabled or simplified when Reduce Motion is enabled in iOS Settings.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-full-accessibility-support/20-RESEARCH.md
@W8Trackr/Views/Goals/MilestoneCelebrationView.swift
@W8Trackr/Views/Animations/SparkleView.swift
@W8Trackr/Views/Animations/AnimationModifiers.swift
@W8Trackr/Views/Onboarding/OnboardingView.swift
@W8Trackr/Views/ToastView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Reduce Motion to MilestoneCelebrationView and OnboardingView</name>
  <files>
    W8Trackr/Views/Goals/MilestoneCelebrationView.swift
    W8Trackr/Views/Onboarding/OnboardingView.swift
  </files>
  <action>
Add Reduce Motion support to milestone celebration and onboarding confetti:

**MilestoneCelebrationView.swift:**
1. Add `@Environment(\.accessibilityReduceMotion) var reduceMotion` property
2. Modify `.confettiCannon()` to use conditional trigger: `trigger: reduceMotion ? .constant(0) : $confettiTrigger`
3. Modify spring animations to use `reduceMotion ? nil : .spring(response: 0.5, dampingFraction: 0.7)`
4. For `.scaleEffect(showContent ? 1.0 : 0.5)`, wrap in conditional animation
5. When Reduce Motion is on, set `showContent = true` immediately in `.onAppear` without animation
6. Keep VoiceOver announcement (important for accessibility, not affected by Reduce Motion)

**OnboardingView.swift:**
1. Add `@Environment(\.accessibilityReduceMotion) var reduceMotion` property
2. Modify `.confettiCannon()` to use conditional trigger: `trigger: reduceMotion ? .constant(0) : $confettiTrigger`
3. Modify TabView `.animation()` to be conditional: `reduceMotion ? nil : .spring(response: 0.5, dampingFraction: 0.8)`
4. Modify step indicator `.animation()` to be conditional

Pattern for conditional animation:
```swift
.animation(reduceMotion ? nil : .spring(response: 0.5, dampingFraction: 0.7), value: showContent)
```

Pattern for confetti:
```swift
.confettiCannon(trigger: reduceMotion ? .constant(0) : $confettiTrigger, num: reduceMotion ? 0 : 50, radius: 400)
```
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
Grep confirms reduceMotion in both files: `grep -l "accessibilityReduceMotion" W8Trackr/Views/Goals/MilestoneCelebrationView.swift W8Trackr/Views/Onboarding/OnboardingView.swift`
  </verify>
  <done>
MilestoneCelebrationView and OnboardingView respect Reduce Motion setting. Confetti is disabled and spring animations are instant when Reduce Motion is enabled.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Reduce Motion to SparkleView and AnimationModifiers</name>
  <files>
    W8Trackr/Views/Animations/SparkleView.swift
    W8Trackr/Views/Animations/AnimationModifiers.swift
  </files>
  <action>
Add Reduce Motion support to all animation utilities:

**SparkleView.swift:**
1. Add `@Environment(\.accessibilityReduceMotion) var reduceMotion` to SparkleView
2. In SparkleView body, return `EmptyView()` when `reduceMotion` is true OR make sparkles static (no animation)
3. Add `reduceMotion` to SparkleParticle - pass as parameter or read from environment
4. In SparkleParticle, skip animation when reduceMotion: set opacity/scale immediately without withAnimation
5. For GlowView: add `@Environment(\.accessibilityReduceMotion) var reduceMotion`, disable `.repeatForever()` animation
6. For ShimmerView: add `@Environment(\.accessibilityReduceMotion) var reduceMotion`, disable animation (show static or hide)
7. For NewLowCelebration: components will inherit reduceMotion from SparkleView and GlowView

**AnimationModifiers.swift:**
1. Add `@Environment(\.accessibilityReduceMotion) var reduceMotion` to AnimatedNumber
2. In AnimatedNumber, use `reduceMotion ? nil : .spring(response: 0.8, dampingFraction: 0.6)`
3. Add reduceMotion to BadgeUnlockView, disable all spring animations when enabled
4. Add reduceMotion to StreakCelebrationView (even though hidden, maintain consistency)
5. Add reduceMotion to BounceModifier - disable bounce when enabled
6. Add reduceMotion to EntranceModifier - set isVisible immediately without animation

For BounceModifier (ViewModifier), since @Environment doesn't work directly in ViewModifier.body(), pass reduceMotion as a parameter to the modifier or use a wrapper approach:
```swift
struct BounceModifier: ViewModifier {
    let delay: Double
    let amount: CGFloat
    let reduceMotion: Bool  // Add parameter
    @State private var bouncing = false

    func body(content: Content) -> some View {
        content
            .offset(y: bouncing ? -amount : 0)
            .onAppear {
                if !reduceMotion {
                    withAnimation(...) { bouncing = true }
                }
            }
    }
}
```

Update the View extension to read environment and pass it:
```swift
extension View {
    func bounce(delay: Double = 0, amount: CGFloat = 5) -> some View {
        modifier(BounceWrapper(delay: delay, amount: amount))
    }
}

struct BounceWrapper: View {
    @Environment(\.accessibilityReduceMotion) var reduceMotion
    let delay: Double
    let amount: CGFloat

    var body: some View {
        // Apply BounceModifier with reduceMotion
    }
}
```
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
Grep confirms reduceMotion in both files: `grep -l "accessibilityReduceMotion" W8Trackr/Views/Animations/SparkleView.swift W8Trackr/Views/Animations/AnimationModifiers.swift`
  </verify>
  <done>
SparkleView, GlowView, ShimmerView, AnimatedNumber, BadgeUnlockView, BounceModifier, and EntranceModifier all respect Reduce Motion. Repeating/infinite animations are disabled and decorative effects are hidden or static.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Reduce Motion to ToastView and remaining animation views</name>
  <files>
    W8Trackr/Views/ToastView.swift
  </files>
  <action>
Add Reduce Motion support to ToastView and verify no other animation views need updates:

**ToastView.swift:**
1. Add `@Environment(\.accessibilityReduceMotion) var reduceMotion` property
2. Modify entrance/exit animations to be conditional: `reduceMotion ? nil : .spring(duration: 0.3)`
3. Ensure toast still appears and disappears (functional), just without spring animation

**Verify other views:**
Search for animation patterns that may need Reduce Motion support:
- `withAnimation` - verify all uses are either essential (navigation) or already wrapped in reduceMotion checks
- `.animation(` - verify all decorative animations have reduceMotion checks
- `.repeatForever` - these MUST have reduceMotion checks (causes motion sickness)

Views that should NOT need changes (essential/navigation animations):
- ContentView (tab selection)
- WeightEntryView (form field expansion)
- LogbookView (list animations)

The goal is decorative animations (celebration, sparkles, bouncing, pulsing) not functional animations (showing/hiding content).
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
Grep confirms no `.repeatForever` without reduceMotion check nearby: manual inspection of grep output
SwiftLint passes: `swiftlint lint --quiet`
  </verify>
  <done>
ToastView respects Reduce Motion. All decorative animations throughout the app are disabled or simplified when Reduce Motion is enabled. Essential navigation animations remain functional.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build succeeds without warnings related to accessibility
2. All files with `.confettiCannon`, `.repeatForever`, or decorative `.spring()` animations have `accessibilityReduceMotion` checks
3. Grep for `accessibilityReduceMotion` shows usage in:
   - MilestoneCelebrationView.swift
   - OnboardingView.swift
   - SparkleView.swift
   - AnimationModifiers.swift
   - ToastView.swift
4. No repeating/infinite animations run without reduceMotion guard
</verification>

<success_criteria>
1. All decorative animations disabled when Settings > Accessibility > Motion > Reduce Motion is ON
2. Confetti cannons do not fire when Reduce Motion is enabled
3. Spring animations use nil animation (instant) when Reduce Motion is enabled
4. Pulsing/bouncing/repeating animations are disabled when Reduce Motion is enabled
5. Essential app functionality (navigation, content display) remains intact
6. Build compiles without errors
7. SwiftLint passes
</success_criteria>

<output>
After completion, create `.planning/phases/20-full-accessibility-support/20-01-SUMMARY.md`
</output>
