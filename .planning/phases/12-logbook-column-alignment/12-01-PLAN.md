---
phase: 12-logbook-column-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Shared/LogbookLayout.swift
  - W8Trackr/Views/Components/LogbookHeaderView.swift
  - W8Trackr/Views/Components/LogbookRowView.swift
autonomous: true

must_haves:
  truths:
    - "Header columns align perfectly with row columns"
    - "All columns render in every row regardless of data availability"
    - "Visual consistency maintained when scrolling through entries"
  artifacts:
    - path: "W8Trackr/Shared/LogbookLayout.swift"
      provides: "Shared layout constants"
      contains: "enum LogbookLayout"
    - path: "W8Trackr/Views/Components/LogbookHeaderView.swift"
      provides: "Column header row"
      contains: "LogbookLayout.columnSpacing"
    - path: "W8Trackr/Views/Components/LogbookRowView.swift"
      provides: "Entry row view"
      contains: "LogbookLayout.columnSpacing"
  key_links:
    - from: "LogbookHeaderView.swift"
      to: "LogbookLayout.swift"
      via: "shared constants"
      pattern: "LogbookLayout\\."
    - from: "LogbookRowView.swift"
      to: "LogbookLayout.swift"
      via: "shared constants"
      pattern: "LogbookLayout\\."
---

<objective>
Fix spacing alignment between logbook header and row columns by extracting shared layout constants and ensuring all columns render consistently regardless of data availability.

Purpose: Users see perfectly aligned columns when viewing weight entries, improving visual clarity and confidence in the data display.

Output: LogbookLayout constants enum, updated LogbookHeaderView and LogbookRowView using those constants, all columns always rendered (with placeholder for missing data).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-logbook-column-alignment/12-RESEARCH.md
@W8Trackr/Views/Components/LogbookHeaderView.swift
@W8Trackr/Views/Components/LogbookRowView.swift
@W8Trackr/Theme/AppTheme.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LogbookLayout constants and update header</name>
  <files>
    W8Trackr/Shared/LogbookLayout.swift
    W8Trackr/Views/Components/LogbookHeaderView.swift
  </files>
  <action>
Create new file W8Trackr/Shared/LogbookLayout.swift with shared layout constants:

```swift
enum LogbookLayout {
    // Spacing between columns
    static let columnSpacing: CGFloat = 12

    // Fixed column widths
    static let dateColumnWidth: CGFloat = 40
    static let weightColumnWidth: CGFloat = 55   // "000.0" with monospacedDigit
    static let avgColumnWidth: CGFloat = 55      // Same as weight for consistency
    static let rateColumnWidth: CGFloat = 50     // Arrow + "0.0"
    static let notesColumnWidth: CGFloat = 24    // Icon width

    // Row dimensions
    static let rowVerticalPadding: CGFloat = 4
    static let minRowHeight: CGFloat = 44        // iOS accessibility minimum

    // Header dimensions (matches AppTheme.Spacing.xs)
    static let headerVerticalPadding: CGFloat = 8
}
```

Update LogbookHeaderView.swift to use LogbookLayout constants with explicit frame modifiers:

1. Line 14: Replace `HStack(spacing: 12)` with `HStack(spacing: LogbookLayout.columnSpacing)`

2. Line 17: Replace `.frame(width: 40, alignment: .leading)` with `.frame(width: LogbookLayout.dateColumnWidth, alignment: .leading)`

3. Lines 21-28: Add explicit frame modifiers to middle columns:
```swift
// Weight column
Text("Weight")
    .frame(width: LogbookLayout.weightColumnWidth, alignment: .trailing)

// Moving average column
Text("Avg")
    .frame(width: LogbookLayout.avgColumnWidth, alignment: .trailing)

// Weekly rate column
Text("Rate")
    .frame(width: LogbookLayout.rateColumnWidth, alignment: .trailing)
```

4. Line 32: Replace `.frame(width: 24)` with `.frame(width: LogbookLayout.notesColumnWidth, alignment: .center)`

5. Line 37: Replace `AppTheme.Spacing.xs` with `LogbookLayout.headerVerticalPadding`

6. Add a new preview to test alignment with empty row data (at end of #Preview section):
```swift
#Preview("Header with Empty Row") {
    let entry = WeightEntry(weight: 170.0, date: .now)
    let rowData = LogbookRowData(
        entry: entry,
        movingAverage: nil,
        weeklyRate: nil,
        hasNote: false
    )
    return VStack(spacing: 0) {
        LogbookHeaderView()
        List {
            LogbookRowView(rowData: rowData, weightUnit: .lb) {}
        }
        .listStyle(.plain)
    }
}
```
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
  </verify>
  <done>
LogbookLayout enum created with all constants. LogbookHeaderView uses LogbookLayout for all spacing and widths. All header columns have explicit widths with trailing alignment for numeric columns. Empty row preview added for alignment testing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update LogbookRowView to always render all columns with fixed widths</name>
  <files>
    W8Trackr/Views/Components/LogbookRowView.swift
  </files>
  <action>
Update LogbookRowView.swift body and column views:

1. Line 29: Replace `HStack(spacing: 12)` with `HStack(spacing: LogbookLayout.columnSpacing)`
2. Line 53: Replace `.padding(.vertical, 4)` with `.padding(.vertical, LogbookLayout.rowVerticalPadding)`
3. Line 75: In dateColumn, replace `.frame(width: 40, alignment: .leading)` with `.frame(width: LogbookLayout.dateColumnWidth, alignment: .leading)`

4. CRITICAL - Remove conditional if statements from body HStack:
   - DELETE lines 39-41: `if rowData.movingAverage != nil { movingAverageColumn }`
   - DELETE lines 44-46: `if rowData.weeklyRate != nil { weeklyRateColumn }`
   - DELETE lines 49-51: `if rowData.hasNote { notesIndicator }`

5. Replace the body HStack content (lines 29-52) with unconditional column rendering:
```swift
HStack(spacing: LogbookLayout.columnSpacing) {
    // Date column: Day number and weekday abbreviation
    dateColumn

    Spacer()

    // Weight value
    weightColumn

    // Moving average (always rendered, empty if nil)
    movingAverageColumn

    // Weekly rate with direction arrow (always rendered, empty if nil)
    weeklyRateColumn

    // Notes indicator (always rendered, empty if no note)
    notesIndicator
}
```

6. Update weightColumn (lines 78-82) to add fixed width:
```swift
private var weightColumn: some View {
    Text(rowData.entry.weightValue(in: weightUnit), format: .number.precision(.fractionLength(1)))
        .font(.body.monospacedDigit())
        .bold()
        .frame(width: LogbookLayout.weightColumnWidth, alignment: .trailing)
}
```

7. Replace movingAverageColumn (lines 84-92) to always render with fixed width:
```swift
private var movingAverageColumn: some View {
    Text(rowData.movingAverage.map {
        $0.formatted(.number.precision(.fractionLength(1)))
    } ?? "")
    .font(.body.monospacedDigit())
    .foregroundStyle(.secondary)
    .frame(width: LogbookLayout.avgColumnWidth, alignment: .trailing)
}
```

8. Replace weeklyRateColumn (lines 94-105) to always render with fixed width:
```swift
private var weeklyRateColumn: some View {
    Group {
        if let rate = rowData.weeklyRate {
            HStack(spacing: 2) {
                Image(systemName: rowData.weightChangeDirection.symbol)
                    .foregroundStyle(rowData.weightChangeDirection.color)
                Text(abs(rate), format: .number.precision(.fractionLength(1)))
                    .font(.caption.monospacedDigit())
            }
        } else {
            Text("")
        }
    }
    .frame(width: LogbookLayout.rateColumnWidth, alignment: .trailing)
}
```

9. Replace notesIndicator (lines 107-111) to always render with fixed width:
```swift
private var notesIndicator: some View {
    Group {
        if rowData.hasNote {
            Image(systemName: "note.text")
                .font(.caption)
                .foregroundStyle(.secondary)
        }
    }
    .frame(width: LogbookLayout.notesColumnWidth, alignment: .center)
}
```
  </action>
  <verify>
Build succeeds. SwiftLint passes: `cd /Users/will/Projects/Saults/W8Trackr && swiftlint lint --quiet`
  </verify>
  <done>
LogbookRowView uses LogbookLayout constants. All columns always render with fixed widths. Empty/missing data shows as blank space maintaining column alignment. Body HStack unconditionally includes all 5 columns. Columns align perfectly with header.
  </done>
</task>

<task type="auto">
  <name>Task 3: Run tests and verify alignment</name>
  <files></files>
  <action>
1. Run test suite to ensure no regressions:
   `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -sdk iphonesimulator test`

2. Verify previews render correctly by building:
   - "Header with Row" preview should show aligned columns with populated data
   - "Header with Empty Row" preview should show aligned columns with empty avg/rate/notes

3. Confirm column alignment is consistent:
   - Date column: left-aligned, fixed 40pt width
   - Weight column: right-aligned, fixed 55pt width
   - Avg column: right-aligned, fixed 55pt width
   - Rate column: right-aligned, fixed 50pt width
   - Notes column: center-aligned, fixed 24pt width
  </action>
  <verify>
All tests pass. Build succeeds without warnings.
  </verify>
  <done>
All tests pass. Column alignment verified: header and row columns use identical spacing (12pt) and widths (40/55/55/50/24pt) via shared LogbookLayout constants. Previews show aligned columns for both populated and sparse rows.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds with no warnings
2. SwiftLint passes
3. All tests pass
4. LogbookLayout.swift exists in W8Trackr/Shared/
5. LogbookHeaderView uses LogbookLayout constants
6. LogbookRowView uses LogbookLayout constants
7. No conditional column rendering in LogbookRowView body
8. Previews show aligned columns regardless of data availability
</verification>

<success_criteria>
- Header columns and row columns use identical spacing and widths via shared LogbookLayout constants
- All five columns (Date, Weight, Avg, Rate, Notes) always render in every row
- Columns maintain perfect alignment when scrolling through entries with varying data
- No visual shift when rows have missing avg/rate/notes data
</success_criteria>

<output>
After completion, create `.planning/phases/12-logbook-column-alignment/12-01-SUMMARY.md`
</output>
