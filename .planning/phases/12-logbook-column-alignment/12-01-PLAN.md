---
phase: 12-logbook-column-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Shared/LogbookLayout.swift
  - W8Trackr/Views/Components/LogbookHeaderView.swift
  - W8Trackr/Views/Components/LogbookRowView.swift
autonomous: true

must_haves:
  truths:
    - "Header columns align perfectly with row columns"
    - "All columns render in every row regardless of data availability"
    - "Visual consistency maintained when scrolling through entries"
  artifacts:
    - path: "W8Trackr/Shared/LogbookLayout.swift"
      provides: "Shared layout constants"
      contains: "enum LogbookLayout"
    - path: "W8Trackr/Views/Components/LogbookHeaderView.swift"
      provides: "Column header row"
      contains: "LogbookLayout.columnSpacing"
    - path: "W8Trackr/Views/Components/LogbookRowView.swift"
      provides: "Entry row view"
      contains: "LogbookLayout.columnSpacing"
  key_links:
    - from: "LogbookHeaderView.swift"
      to: "LogbookLayout.swift"
      via: "shared constants"
      pattern: "LogbookLayout\\."
    - from: "LogbookRowView.swift"
      to: "LogbookLayout.swift"
      via: "shared constants"
      pattern: "LogbookLayout\\."
---

<objective>
Fix spacing alignment between logbook header and row columns by extracting shared layout constants and ensuring all columns render consistently regardless of data availability.

Purpose: Users see perfectly aligned columns when viewing weight entries, improving visual clarity and confidence in the data display.

Output: LogbookLayout constants enum, updated LogbookHeaderView and LogbookRowView using those constants, all columns always rendered (with placeholder for missing data).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-logbook-column-alignment/12-RESEARCH.md
@W8Trackr/Views/Components/LogbookHeaderView.swift
@W8Trackr/Views/Components/LogbookRowView.swift
@W8Trackr/Theme/AppTheme.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LogbookLayout constants and update header</name>
  <files>
    W8Trackr/Shared/LogbookLayout.swift
    W8Trackr/Views/Components/LogbookHeaderView.swift
  </files>
  <action>
Create new file W8Trackr/Shared/LogbookLayout.swift with shared layout constants:

```swift
enum LogbookLayout {
    // Spacing between columns
    static let columnSpacing: CGFloat = 12

    // Fixed column widths
    static let dateColumnWidth: CGFloat = 40
    static let weightColumnWidth: CGFloat = 55   // "000.0" with monospacedDigit
    static let avgColumnWidth: CGFloat = 55      // Same as weight for consistency
    static let rateColumnWidth: CGFloat = 50     // Arrow + "0.0"
    static let notesColumnWidth: CGFloat = 24    // Icon width

    // Row dimensions
    static let rowVerticalPadding: CGFloat = 4
    static let minRowHeight: CGFloat = 44        // iOS accessibility minimum

    // Header dimensions (matches AppTheme.Spacing.xs)
    static let headerVerticalPadding: CGFloat = 8
}
```

Update LogbookHeaderView.swift to use LogbookLayout constants:
- Replace `spacing: 12` with `spacing: LogbookLayout.columnSpacing`
- Replace `width: 40` with `width: LogbookLayout.dateColumnWidth`
- Add fixed widths to middle columns (Weight, Avg, Rate) using new constants
- Replace `width: 24` with `width: LogbookLayout.notesColumnWidth`
- Replace `AppTheme.Spacing.xs` with `LogbookLayout.headerVerticalPadding`

All middle columns (Weight, Avg, Rate) should have fixed widths and trailing alignment to match data formatting.
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
  </verify>
  <done>
LogbookLayout enum created with all constants. LogbookHeaderView uses LogbookLayout for all spacing and widths. All header columns have explicit widths.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update LogbookRowView to always render all columns with fixed widths</name>
  <files>
    W8Trackr/Views/Components/LogbookRowView.swift
  </files>
  <action>
Update LogbookRowView.swift body and column views:

1. Replace `spacing: 12` with `spacing: LogbookLayout.columnSpacing`
2. Replace `.padding(.vertical, 4)` with `.padding(.vertical, LogbookLayout.rowVerticalPadding)`
3. Update dateColumn: use `LogbookLayout.dateColumnWidth` instead of hardcoded `40`

4. CRITICAL - Always render all columns (no conditional if statements):

For weightColumn:
- Add `.frame(width: LogbookLayout.weightColumnWidth, alignment: .trailing)`

For movingAverageColumn:
- Remove conditional `if rowData.movingAverage != nil` from body
- Change implementation to always render, showing value or placeholder:
```swift
private var movingAverageColumn: some View {
    Text(rowData.movingAverage.map {
        $0.formatted(.number.precision(.fractionLength(1)))
    } ?? "")
    .font(.body.monospacedDigit())
    .foregroundStyle(.secondary)
    .frame(width: LogbookLayout.avgColumnWidth, alignment: .trailing)
}
```

For weeklyRateColumn:
- Remove conditional `if rowData.weeklyRate != nil` from body
- Change implementation to always render, showing arrow+value or empty placeholder:
```swift
private var weeklyRateColumn: some View {
    Group {
        if let rate = rowData.weeklyRate {
            HStack(spacing: 2) {
                Image(systemName: rowData.weightChangeDirection.symbol)
                    .foregroundStyle(rowData.weightChangeDirection.color)
                Text(abs(rate), format: .number.precision(.fractionLength(1)))
                    .font(.caption.monospacedDigit())
            }
        } else {
            Text("")
        }
    }
    .frame(width: LogbookLayout.rateColumnWidth, alignment: .trailing)
}
```

For notesIndicator:
- Remove conditional `if rowData.hasNote` from body
- Change to always render with conditional content:
```swift
private var notesIndicator: some View {
    Group {
        if rowData.hasNote {
            Image(systemName: "note.text")
                .font(.caption)
                .foregroundStyle(.secondary)
        }
    }
    .frame(width: LogbookLayout.notesColumnWidth, alignment: .center)
}
```

5. Update body HStack to unconditionally include all columns:
```swift
HStack(spacing: LogbookLayout.columnSpacing) {
    dateColumn
    Spacer()
    weightColumn
    movingAverageColumn
    weeklyRateColumn
    notesIndicator
}
```

Remove the three `if` statements that conditionally render columns.
  </action>
  <verify>
Build succeeds. SwiftLint passes: `cd /Users/will/Projects/Saults/W8Trackr && swiftlint lint --quiet`
  </verify>
  <done>
LogbookRowView uses LogbookLayout constants. All columns always render with fixed widths. Empty/missing data shows as blank space maintaining column alignment. Columns align perfectly with header.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify alignment in previews and run tests</name>
  <files>
    W8Trackr/Views/Components/LogbookHeaderView.swift
    W8Trackr/Views/Components/LogbookRowView.swift
  </files>
  <action>
1. Update preview in LogbookHeaderView.swift "Header with Row" to test alignment:
   - Keep existing preview that shows header with populated row
   - Add new preview showing header with row that has NO avg/rate/notes (tests column stability)

```swift
#Preview("Header with Empty Row") {
    let entry = WeightEntry(weight: 170.0, date: .now)
    let rowData = LogbookRowData(
        entry: entry,
        movingAverage: nil,
        weeklyRate: nil,
        hasNote: false
    )
    return VStack(spacing: 0) {
        LogbookHeaderView()
        List {
            LogbookRowView(rowData: rowData, weightUnit: .lb) {}
        }
        .listStyle(.plain)
    }
}
```

2. Verify previews render correctly - columns should align whether data is present or not

3. Run test suite to ensure no regressions:
`xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -sdk iphonesimulator test`
  </action>
  <verify>
All tests pass. Previews show aligned columns for both populated and sparse rows.
  </verify>
  <done>
Preview added for empty data case. All tests pass. Column alignment verified in both data states (populated and empty).
  </done>
</task>

</tasks>

<verification>
1. Build succeeds with no warnings
2. SwiftLint passes
3. All tests pass
4. LogbookLayout.swift exists in W8Trackr/Shared/
5. LogbookHeaderView uses LogbookLayout constants
6. LogbookRowView uses LogbookLayout constants
7. No conditional column rendering in LogbookRowView body
8. Previews show aligned columns regardless of data availability
</verification>

<success_criteria>
- Header columns and row columns use identical spacing and widths via shared LogbookLayout constants
- All five columns (Date, Weight, Avg, Rate, Notes) always render in every row
- Columns maintain perfect alignment when scrolling through entries with varying data
- No visual shift when rows have missing avg/rate/notes data
</success_criteria>

<output>
After completion, create `.planning/phases/12-logbook-column-alignment/12-01-SUMMARY.md`
</output>
