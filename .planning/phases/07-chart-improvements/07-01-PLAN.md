---
phase: 07-chart-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Views/WeightTrendChartView.swift
autonomous: true

must_haves:
  truths:
    - "Prediction line extends 14 days beyond last data point"
    - "User can scroll chart horizontally to explore historical data"
    - "Tapping chart shows exact weight value at that date"
    - "Selection indicator appears at tapped position"
    - "Chart feels responsive and smooth"
  artifacts:
    - path: "W8Trackr/Views/WeightTrendChartView.swift"
      provides: "Extended prediction, scrolling, tap selection"
      contains: "chartScrollableAxes"
  key_links:
    - from: "WeightTrendChartView.swift"
      to: "TrendCalculator.calculateHolt"
      via: "forecast(daysAhead: 14)"
      pattern: "daysAhead.*14"
    - from: "WeightTrendChartView.swift"
      to: "Chart selection state"
      via: "chartXSelection binding"
      pattern: "chartXSelection.*selectedDate"
---

<objective>
Add chart interactivity: extend prediction line to 14 days, enable horizontal scrolling, and add tap-to-select with value display.

Purpose: Makes the weight chart more confidence-inspiring by showing extended predictions and allowing users to explore their historical data and see exact values.

Output: WeightTrendChartView.swift updated with scrollable axes, extended prediction, and tap selection capability.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-chart-improvements/07-RESEARCH.md

# Key source files
@W8Trackr/Views/WeightTrendChartView.swift
@W8Trackr/Analytics/TrendCalculator.swift
@W8Trackr/Theme/Colors.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend prediction line to 14 days</name>
  <files>W8Trackr/Views/WeightTrendChartView.swift</files>
  <action>
Extend the prediction line from 1 day to 14 days ahead:

1. Change `let daysAhead = 1` to `let daysAhead = 14` in the `prediction` computed property (around line 85).

2. Update the prediction computation to generate intermediate points for a smooth curve. Instead of just start and end points, generate points at days 0, 7, and 14 to show trajectory.

3. Ensure the x-axis domain includes the prediction dates by updating `chartXScale` if needed (the chart should auto-extend, but verify).

4. The prediction line should use existing `isPrediction = true` flag and `ChartPredicted` color styling.

Important: Do NOT change the Holt calculation parameters (alpha/beta) - just the forecast horizon.
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build`
Preview shows prediction line extending ~14 days beyond last data point.
  </verify>
  <done>Prediction line extends 14 days beyond the last actual weight entry, visible in all date ranges.</done>
</task>

<task type="auto">
  <name>Task 2: Enable horizontal scrolling</name>
  <files>W8Trackr/Views/WeightTrendChartView.swift</files>
  <action>
Add horizontal scrolling to allow exploring historical data:

1. Add `.chartScrollableAxes(.horizontal)` modifier to the Chart.

2. Add `.chartXVisibleDomain(length:)` to control the visible window. Create a computed property `visibleDomainSeconds` that returns an appropriate TimeInterval based on `selectedRange`:
   - oneWeek: 10 days (slightly more than week for context)
   - oneMonth: 35 days
   - threeMonth: 45 days (subset, scroll for more)
   - sixMonth: 60 days
   - oneYear: 90 days
   - allTime: 120 days
   Formula: `days * 86400` (seconds per day)

3. Add `@State private var scrollPosition: Date = Date()` and `.chartScrollPosition(x: $scrollPosition)` to track scroll position.

4. Position scroll at most recent data on appear (already at Date(), which should work).

5. Place modifiers in order: `.chartScrollableAxes(.horizontal)` then `.chartXVisibleDomain(length:)` then `.chartScrollPosition(x:)`.

The existing `.animation(.snappy, value: selectedRange)` should continue to work.
  </action>
  <verify>
Build succeeds.
Chart can be scrolled horizontally to reveal older data.
Switching date ranges updates visible domain appropriately.
  </verify>
  <done>Chart scrolls horizontally, visible domain matches selected range, scroll position starts at most recent data.</done>
</task>

<task type="auto">
  <name>Task 3: Add tap selection with value display</name>
  <files>W8Trackr/Views/WeightTrendChartView.swift</files>
  <action>
Add tap-to-select showing exact weight values:

1. Add `@State private var selectedDate: Date?` state property.

2. Add `.chartXSelection(value: $selectedDate)` modifier to the Chart.

3. Create a computed property `selectedEntry` that finds the closest actual data point to the selected date:
   ```swift
   private var selectedEntry: ChartEntry? {
       guard let selected = selectedDate else { return nil }
       return chartData
           .filter { !$0.isPrediction && $0.showPoint }
           .min(by: { abs($0.date.timeIntervalSince(selected)) < abs($1.date.timeIntervalSince(selected)) })
   }
   ```

4. Add selection indicator in the Chart body (before closing Chart brace):
   - RuleMark with x value at selected entry date (vertical line)
   - PointMark highlighting the selected point with larger symbol
   Use `AppColors.accent` for the highlight color, secondary opacity for the rule line.

5. Add a selection value display above the Chart (inside VStack, before Chart):
   ```swift
   @ViewBuilder
   private var selectionDisplay: some View {
       if let entry = selectedEntry {
           HStack {
               Text(entry.date, format: .dateTime.month().day())
               Spacer()
               Text("\(entry.weight, format: .number.precision(.fractionLength(1))) \(weightUnit.rawValue)")
                   .bold()
           }
           .font(.caption)
           .foregroundStyle(AppColors.textSecondary)
           .padding(.horizontal)
       }
   }
   ```

6. Insert `selectionDisplay` at the top of the VStack (after VStack opening, before Chart).

7. iOS 18 Bug Check: If scrolling stops working after adding chartXSelection, implement the ZStack workaround from RESEARCH.md. Test first - the bug may be fixed in iOS 26.

Important: Filter out prediction points from selection - only show actual recorded data values.
  </action>
  <verify>
Build succeeds.
Tapping on chart shows exact weight value for that date.
Selection indicator (vertical line + highlighted point) appears at tap location.
Tapping empty area or scrolling clears selection (or updates it).
Scrolling AND selection both work together (no iOS 18 bug regression).
SwiftLint passes: `swiftlint lint --path W8Trackr/Views/WeightTrendChartView.swift`
  </verify>
  <done>Tap selection works, shows exact weight and date, selection indicator visible, scrolling still functional.</done>
</task>

</tasks>

<verification>
1. Build succeeds with no errors
2. Prediction line extends 14 days beyond last entry (visible in preview)
3. Chart scrolls horizontally to reveal historical data
4. Tapping chart shows exact weight value
5. Selection indicator appears at tapped position
6. Scrolling and selection work together (no conflict)
7. All date ranges (1W, 1M, 3M, 6M, 1Y, All) work correctly
8. SwiftLint passes with zero violations
9. VoiceOver accessibility still works (existing implementation)
</verification>

<success_criteria>
- Prediction line extends 14 days ahead (CHART-01)
- Chart can be scrolled horizontally (CHART-02)
- Tapping shows exact weight value (CHART-03)
- Chart feels responsive and confidence-inspiring
- No regressions to existing chart functionality
</success_criteria>

<output>
After completion, create `.planning/phases/07-chart-improvements/07-01-SUMMARY.md`
</output>
