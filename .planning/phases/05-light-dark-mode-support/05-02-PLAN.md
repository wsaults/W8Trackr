---
phase: 05-light-dark-mode-support
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - W8Trackr/Views/WeightTrendChartView.swift
  - W8Trackr/Views/Animations/AnimationModifiers.swift
  - W8Trackr/Views/Animations/ConfettiView.swift
  - W8Trackr/Views/Animations/SparkleView.swift
  - W8Trackr/Views/ToastView.swift
  - W8Trackr/Views/Onboarding/GoalStepView.swift
  - W8Trackr/Views/Onboarding/FirstWeightStepView.swift
autonomous: true

must_haves:
  truths:
    - "Charts and visualizations adapt to color scheme"
    - "No deprecated foregroundColor() calls remain"
    - "No deprecated UIScreen.main.bounds usage remains"
  artifacts:
    - path: "W8Trackr/Views/WeightTrendChartView.swift"
      provides: "Adaptive chart colors"
      contains: "AppColors.chartEntry"
    - path: "W8Trackr/Views/Animations/ConfettiView.swift"
      provides: "Celebration colors using AppColors"
      contains: "AppColors.primary"
    - path: "W8Trackr/Views/Animations/SparkleView.swift"
      provides: "Sparkle effect with adaptive default"
      contains: "AppColors.success"
  key_links:
    - from: "WeightTrendChartView.swift"
      to: "W8Trackr/Theme/Colors.swift"
      via: "chartForegroundStyleScale mapping"
      pattern: "AppColors\\.chart(Entry|Predicted)"
---

<objective>
Fix chart colors to use adaptive AppColors, replace deprecated foregroundColor() with foregroundStyle(), replace UIScreen.main.bounds with GeometryReader, and migrate Animation views from AppColors.Fallback.

Purpose: Complete light/dark mode support for charts and animations, eliminate deprecated APIs
Output: Chart view using adaptive colors, all animation files using AppColors, no deprecated API usage
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-light-dark-mode-support/05-RESEARCH.md
@W8Trackr/Theme/Colors.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate chart colors and fix deprecated APIs</name>
  <files>
    W8Trackr/Views/WeightTrendChartView.swift
    W8Trackr/Views/ToastView.swift
    W8Trackr/Views/Onboarding/GoalStepView.swift
    W8Trackr/Views/Onboarding/FirstWeightStepView.swift
  </files>
  <action>
**WeightTrendChartView.swift:**
Replace hardcoded chart colors (lines 266-268):
```swift
// BEFORE
.chartForegroundStyleScale([
    "Entry": Color.blue,
    "Trend": Color.blue,
    "Predicted": Color.orange
])

// AFTER
.chartForegroundStyleScale([
    "Entry": AppColors.chartEntry,
    "Trend": AppColors.chartEntry,
    "Predicted": AppColors.chartPredicted
])
```

**ToastView.swift:**
- Line 53: Replace `.foregroundColor(type.iconColor)` with `.foregroundStyle(type.iconColor)`

**GoalStepView.swift:**
- Line 52: Replace `.foregroundColor(isValidGoal ? Color.primary : Color.red)` with `.foregroundStyle(isValidGoal ? Color.primary : Color.red)`

**FirstWeightStepView.swift:**
- Line 52: Replace `.foregroundColor(isValidWeight ? Color.primary : Color.red)` with `.foregroundStyle(isValidWeight ? Color.primary : Color.red)`

Note: Color.primary and Color.red are semantic SwiftUI colors that adapt automatically - keep them.
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build 2>&1 | grep -E "(error:|BUILD SUCCEEDED)"`
No foregroundColor() calls: `grep -r "foregroundColor(" W8Trackr/Views/ | wc -l` returns 0
Chart uses AppColors: `grep "AppColors.chartEntry" W8Trackr/Views/WeightTrendChartView.swift | wc -l` returns at least 1
  </verify>
  <done>Chart colors use adaptive AppColors.chartEntry/chartPredicted, all foregroundColor() calls replaced with foregroundStyle()</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Animation views and replace UIScreen.main.bounds</name>
  <files>
    W8Trackr/Views/Animations/AnimationModifiers.swift
    W8Trackr/Views/Animations/ConfettiView.swift
    W8Trackr/Views/Animations/SparkleView.swift
    W8Trackr/Views/Goals/MilestoneCelebrationView.swift
  </files>
  <action>
**AnimationModifiers.swift:**
- Line 222: `AppColors.Fallback.warning.opacity(0.5)` -> `AppColors.warning.opacity(0.5)`
- Line 268: `AppColors.Fallback.warning` -> `AppColors.warning`
- Line 422: `AppColors.Fallback.accent` -> `AppColors.accent`
- Lines 92, 212: Keep `Color.black.opacity(0.5)` - these are intentional overlay backgrounds for modals

**ConfettiView.swift:**
- Lines 27-31: Replace Fallback colors with AppColors:
  ```swift
  // BEFORE
  AppColors.Fallback.primary,
  AppColors.Fallback.secondary,
  AppColors.Fallback.accent,
  AppColors.Fallback.success,
  AppColors.Fallback.warning,

  // AFTER
  AppColors.primary,
  AppColors.secondary,
  AppColors.accent,
  AppColors.success,
  AppColors.warning,
  ```
- Lines 32-33: Keep `Color.yellow, Color.pink` - celebration confetti should stay vibrant regardless of mode
- Line 279: Keep `Color.black.opacity(0.3)` - shadow effect
- Line 288: Keep `Color.white` - confetti highlight
- Lines 113, 175: Replace `UIScreen.main.bounds.height` with GeometryReader approach:
  Add a stored property for screen height calculated in onAppear, or use a GeometryReader wrapper.
  Simplest fix: Use a large constant like `2000` for offscreen position (confetti flies off bottom of screen).

**SparkleView.swift:**
- Lines 24, 159, 182, 207, 227: Replace `AppColors.Fallback.success` default parameter with `AppColors.success`
- Line 239: Keep `Color.gray.opacity(0.2)` for sparkle background (subtle, works in both modes)
- Line 255: Keep `Color.white` for sparkle highlight

**MilestoneCelebrationView.swift:**
- Line 159: Replace `UIScreen.main.bounds.height` - same approach as ConfettiView
- Line 23: Keep `Color.black.opacity(0.4)` - modal overlay dimming
  </action>
  <verify>
Build succeeds: `xcodebuild -project W8Trackr.xcodeproj -scheme W8Trackr -configuration Debug -sdk iphonesimulator build 2>&1 | grep -E "(error:|BUILD SUCCEEDED)"`
No AppColors.Fallback in Animations: `grep -r "AppColors.Fallback" W8Trackr/Views/Animations/ | wc -l` returns 0
No UIScreen.main.bounds: `grep -r "UIScreen.main.bounds" W8Trackr/Views/ | wc -l` returns 0
  </verify>
  <done>Animation views use AppColors instead of Fallback, UIScreen.main.bounds replaced with safe alternative</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Build succeeds with no errors
2. `grep -r "AppColors.Fallback" W8Trackr/Views/` returns 0 results
3. `grep -r "foregroundColor(" W8Trackr/Views/` returns 0 results
4. `grep -r "UIScreen.main.bounds" W8Trackr/Views/` returns 0 results
5. `grep "AppColors.chartEntry" W8Trackr/Views/WeightTrendChartView.swift` returns matches
6. SwiftLint passes: `swiftlint lint --quiet 2>&1 | wc -l` shows no new violations
</verification>

<success_criteria>
- WeightTrendChartView uses AppColors.chartEntry and AppColors.chartPredicted for chart lines
- All foregroundColor() calls replaced with foregroundStyle()
- All UIScreen.main.bounds usage replaced with safe alternative
- AnimationModifiers uses AppColors instead of AppColors.Fallback
- ConfettiView uses AppColors for theme colors (keeps vibrant yellow/pink for celebration)
- SparkleView uses AppColors.success as default parameter
- Build succeeds with no errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/05-light-dark-mode-support/05-02-SUMMARY.md`
</output>
